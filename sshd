# sshd grok patterns

# Authentication messages
SSHD_AUTH 				(?:%{SSHD_AUTH_REQUEST}|%{SSHD_AUTH_STAT}|%{SSHD_USER_GROUPS}|%{SSHD_KEYAUTH})
SSHD_AUTH_REQUEST 		debug1: userauth-request for user %{USERNAME:user__name} service (?<service__name>[\w\d-]+) method %{WORD:sshd__authentication__method}(?:%{GREEDYDATA}|})
SSHD_AUTH_STAT 			debug1: attempt %{NUMBER:sshd__authentication__attempt} failures %{NUMBER:sshd__authentication__failures}%{GREEDYDATA}
SSHD_USER_GROUPS 		debug1: user %{USERNAME:user__name} matched group list (?<_tmp__user__groups>[\w,\d]+)%{GREEDYDATA}
SSHD_KEYAUTH			debug1: matching key found: file %{UNIXPATH:sshd__keyauth__path}, line %{POSINT:sshd__keyauth__linenum} %{WORD:sshd__keyauth__algorithm} %{GREEDYDATA:sshd__keyauth__fingerprint}


# Session and connection messages
SSHD_SESSION 			(?:%{SSHD_SESSION_CLOSED}|%{SSHD_SESSION_CLOSED2}|%{SSHD_CONN_CLOSING}|%{SSHD_CONN_CLOSED}|%SSHD_SESSION_XFER_BYTES)
SSHD_SESSION_CLOSED 	session closed for local user %{USERNAME:user__name} from \[%{IP:client__ip}]%{GREEDYDATA}
SSHD_SESSION_CLOSED2	Close session: user %{USERNAME:user__name} from %{IP:client__ip} port %{POSINT:sshd__port}%{GREEDYDATA} id %{NUMBER:ssh__channel}%{GREEDYDATA}
SSHD_SESSION_XFER_BYTES Transferred: sent %{NUMBER:sshd__session__sent__bytes}, received %{NUMBER:sshd__session__rcvd__bytes}%{GREEDYDATA}	
SSHD_CONN_CLOSING		Closing connection to %{IP:client__ip} port %{POSINT:sshd__port}%{GREEDYDATA}
SSHD_CONN_CLOSED		Connection closed by %{IP:client__ip} port %{POSINT:sshd__port}%{GREEDYDATA}

# File access
SSHD_FILE 				(?:%{SSHD_FILE_ACCESS}|%{SSHD_FILE_ACCESS_MSG})
SSHD_FILE_ACCESS 		(?<file__access__action>[\w,]+) %{QUOTEDSTRING:file__path} flags %{WORD:file__access__type} mode (?<file__mode>[0-9]+)(?:%{GREEDYDATA}|})
SSHD_FILE_ACCESS_MSG 	sent status %{GREEDYDATA:file__access__message}

# PAM messages
SSHD_PAM 				(?:%{SSHD_PAM_INIT}|%{SSHD_PAM_CLIENT}|%{SSHD_PAM_TTY}|%{SSHD_PAM_OPEN}|%{SSHD_PAM_CLOSE})
SSHD_PAM_INIT 			debug1: PAM: initializing for "%{USERNAME:user__name}"
SSHD_PAM_CLIENT 		debug1: PAM: setting PAM_RHOST to "%{IP:client__ip}"
SSHD_PAM_TTY 			debug1: PAM: setting PAM_TTY to "%{WORD:sshd__pam__tty}"
SSHD_PAM_OPEN   		pam_unix\(sshd:session\): session opened for user %{USERNAME:user__name} by \(uid=\d+\)
SSHD_PAM_CLOSE  		pam_unix\(sshd:session\): session closed for user %{USERNAME:user__name}

# Errors and warnings
SSHD_ERROR 				(?:{SSHD_PAM_FAIL}|%{SSHD_PAM_LOGOUT_ERR})
SSHD_PAM_FAIL   		pam_systemd\(sshd:session\): Failed to release session: %{GREEDYDATA:sshd__disconnect__fail}
SSHD_PAM_LOGOUT_ERR     syslogin_perform_logout: logout\(\) returned an error


# General
SSHD_SYSLOG_HEAD 		%{SYSLOGTIMESTAMP:timestamp} (?<host__hostname>[\w-]+) %{WORD:process__name}\[%{POSINT:process__id}]:

SSHD %{SSHD_SYSLOG_HEAD} (?:%{SSHD_AUTH}|%{SSHD_SESSION}|%{SSHD_FILE}|%{SSHD_PAM}|%{SSHD_ERROR})
